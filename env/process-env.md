# 进程环境

### main 函数

主函数原型：

``` c
int main(int argc, char *argv[]);
```

`argc` 指的是命令行参数个数

`argv` 指的是指向参数的各个指针组成的数组

注意 main 内核调用它的顺序

### 进程终止

5 种正常终止的方式

三个 `exit` 函数

`atexit` 终止处理函数

一个 C 程序如何启动和终止

``` c

|   k  |<----- Exit|_exit <----| <-------|
|   e  | -> C 启动例程 -> main 函数 -> 用户函数
|   r  |                        exit <---|
|   n  |                          | <--> 终止处理程序
|   e  |                          | <--> 标准 I/O 清理程序
|   l  |<-------------------------|

```

### 命令行参数

一个小技巧
``` c
for (int i = 0; argv[i] != NULL; i++)
```

### 环境表

环境变量：

``` c
extern char **environ;
```

### C 程序的存储空间布局

c 程序组成：
- 正文段，CPU 执行的机器指令部分。
- 初始化数据段
- 未初始化数据段(bss)
- 栈(自动变量以及每次函数调用时所需保存的信息都存放在此段中)
- 堆(动态存储分配)

|                | 高地址段（命令行参数和环境变量）
|       栈       |
|                |
|                |
|       堆       |
| 未初始化的数据 | 由 exec 初始化
|    (bbs)       | 为 0
|  初始化的数据  | 由 exec 从程序
|      正文      | 文件中读入

### 共享库

共享库使得可执行文件中不再需要包含公用的库函数，
而只需要在所有进程都可引用都存储区中保存这种库都一个副本

程序第一次执行或第一次调用某个库函数时，用动态链接方法将共享库函数相链接

运行时换空间

可以共享库新版本替换老版本时无需编译

### 存储空间分配

1. `malloc`

1. `calloc`

1. `realloc`

``` c
#include <stdlib.h>

void *malloc(size_t size); // 分配初始不定

void *calloc(size_t nobj, size_t size); // 指定对象指定数量，分配初始为 0

void *relloc(void *ptr, size_t newsize); // 重新

void free(void *ptr);
```

三个动态分配内存的函数以及释放空间的 `free` 函数要非常谨慎，否则非常容易出错

存在其他一些替代的存储空间分配程序

### 环境变量




